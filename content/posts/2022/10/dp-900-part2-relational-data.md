---
title: DP-900：Azure 数据基础第二部分之 Azure 中的关系型数据
author: olzhy
type: post
date: 2022-10-27T16:07:00+08:00
url: /posts/dp-900-part2-relational-data.html
categories:
  - 计算机
tags:
  - Azure
keywords:
  - 数据库
description: Azure 中的关系型数据。包括基本的关系数据概念和 Azure 中的关系型数据库服务。
---

**本文依据文末 Azure 参考资料进行翻译及整理，作学习及知识总结之用。**

关系型数据是大多数业务应用程序的核心，也是构建许多企业数据解决方案的基础。 Azure 提供用于管理关系型数据库的服务，使您能够构建新应用程序或将现有应用程序迁移到云。

## 1 基本的关系型数据概念

在计算系统的早期，每个应用程序都以自己独特的结构存储数据。当开发人员想要构建应用程序来使用这些数据时，他们必须对特定的数据结构有很多了解才能找到他们需要的数据。这些数据结构效率低下，难以维护，并且难以优化以获得良好的应用程序性能。关系数据库模型旨在解决多个任意数据结构的问题。关系模型提供了一种表示和查询可供任何应用程序使用的数据的标准方法。关系数据库模型的主要优势之一是它使用表，这是一种直观、高效且灵活的存储和访问结构化信息的方式。

各种类型和规模的组织都使用简单而强大的关系模型来满足各种信息管理需求。关系型数据库用于跟踪库存、处理电子商务交易、管理大量关键任务客户信息等。关系型数据库可用于存储任何包含相关数据元素的信息，这些数据元素必须以基于规则的一致结构进行组织。

在本部分，您将了解关系型数据库的关键特征，并探索关系数据结构。

### 1.1 了解关系型数据

在关系型数据库中，您将来自现实世界的实体集合建模为表。实体可以是您要为其记录信息的任何事物；通常是重要的对象和事件。例如，在零售系统示例中，您可以为客户、产品、订单和订单中的行项目创建表。一个表包含多行，每一行代表一个实体的一个实例。

![关系表](https://olzhy.github.io/static/images/uploads/2022/10/relational-tables.png#center)

关系表是结构化数据的一种格式，表中的每一行都有相同的列；尽管在某些情况下，并非所有列都需要有值（如上图中的 MiddleName）。

每列存储特定数据类型的数据。如，客户表中的电子邮件列可能被定义为存储字符类型的数据（长度可能是固定的或可变的），产品表中的价格列可能被定义为存储十进制数字数据，Order 表中的 Quantity 列可能被限制为整数数值，而 Order 表中的 OrderDate 列用来存储日期或时间值。定义表时可以使用的数据类型取决于您使用的数据库系统，尽管大多数数据库系统都支持 ANSI（American National Standards Institute，美国国家标准协会）定义的标准数据类型。

### 1.2 了解规范化

规范化是数据库专业人员用于模式设计过程的一个术语，其将数据重复降至最低并加强了数据完整性。

虽然有许多复杂的规则定义了将数据重构为不同级别的规范化过程，但一个出于实际目的的简单定义为：

- 将每个实体分割到自己的表中；
- 将每个离散属性分成自己的列；
- 使用主键唯一标识每个实体实例（行）；
- 使用外键列链接相关实体。

要了解规范化的核心原则，假设下表代表公司用来跟踪其销售的电子表格。

![非规范化数据](https://olzhy.github.io/static/images/uploads/2022/10/unnormalized-data.png#center)

请注意，如上表中客户和产品详细信息对于所售出的每件商品都是重复的；并且客户姓名和邮政地址，以及产品名称和价格组合在同一个电子表格单元格中。

现在让我们看看规范化如何改变数据的存储方式。

![规范化后的数据](https://olzhy.github.io/static/images/uploads/2022/10/normalized-data.png#center)

数据中表示的每个实体（客户、产品、销售订单和行条目）都存储在自己的表中，这些实体的每个离散属性都在自己的列中。

将实体的每个实例记录为实体特定表中的一行可以消除数据重复。例如，要更改客户的地址，您只需修改单行中的值。

将属性分解为单独的列可确保将每个值限制为适当的数据类型。例如，产品价格必须是十进制值，而行条目数量必须是整数。此外，单个列的创建为查询数据提供了有用的粒度级别。例如，您可以轻松地将客户筛选为居住在特定城市的人。

每个实体的实例由一个 ID（或称为主键） 唯一标识，当一个实体引用另一个实体时（例如，订单有关联的客户），相关实体的主键被存储为外键。您可以通过引用 Customer 表中的相应记录来查找 Order 表中每条记录的客户地址（仅存储一次）。通常，关系数据库管理系统 (RDBMS) 可以强制执行参照完整性，以确保输入到外键字段中的值在相关表中具有存在的对应主键 —— 例如，阻止不存在的客户订单。

在某些情况下，可以将键（主键或外键）定义为基于多个列的唯一组合的组合键。例如，上例中的 LineItem 表使用 OrderNo 和 ItemNo 的唯一组合来识别单个订单中的行项目。

### 1.3 探索 SQL

SQL 代表结构化查询语言（Structured Query Language），用于与关系数据库进行通信。SQL 语句用于执行诸如更新或检索数据等任务。一些使用 SQL 的常见关系数据库管理系统包括 Microsoft SQL Server、MySQL、PostgreSQL、MariaDB 和 Oracle。

**_SQL 最初于 1986 年由美国国家标准协会 (ANSI，American National Standards Institute) 标准化，并于 1987 年由国际标准化组织 (ISO，International Organization for Standardization) 标准化。从那时起，随着关系数据库供应商向其系统中添加新功能，该标准已多次扩展.此外，大多数数据库供应商都包括他们自己的专有扩展，这些扩展不属于标准的一部分，这导致了各种 SQL 方言。_**

您可以使用 SELECT、INSERT、UPDATE、DELETE、CREATE 和 DROP 等 SQL 语句来完成几乎所有需要对数据库执行的操作。尽管这些 SQL 语句是 SQL 标准的一部分，但许多数据库管理系统也有自己的附加专有扩展来处理该数据库管理系统的细节。这些扩展提供 SQL 标准未涵盖的功能，并包括安全管理和可编程性等领域。

例如，基于 SQL Server 数据库引擎的 Microsoft SQL Server 和 Azure 数据库服务使用了 Transact-SQL。该实现包括用于编写存储过程、触发器（可以存储在数据库中的应用程序代码）以及管理用户帐户的专有扩展。 PostgreSQL 和 MySQL 也有自己的这些特性的版本。

一些流行的 SQL 方言包括：

- Transact-SQL (T-SQL)，此版本的 SQL 由 Microsoft SQL Server 和 Azure SQL 服务所使用。
- pgSQL，这是在 PostgreSQL 中实现了扩展的 SQL 方言。
- PL/SQL，这是甲骨文使用的方言。 PL/SQL 代表 Procedural Language/SQL。

计划专门使用单个数据库系统的用户应该了解他们首选的 SQL 方言和平台的复杂性。

**_除非另有说明，本模块中的 SQL 代码示例均基于 Transact-SQL 方言。其他方言的语法大体相似，但在某些细节上可能有所不同。_**

#### SQL 语句类型

SQL 语句主要分三种：

- 数据定义语言 (Data Definition Language，DDL)
- 数据控制语言 (Data Control Language，DCL)
- 数据操作语言 (Data Manipulation Language，DML)

**DDL 语句**

您可以使用 DDL 语句来创建、修改和删除数据库中的表和其他对象（表、存储过程、视图等）。

最常见的 DDL 语句是：

| 语句   | 描述                                     |
| ------ | ---------------------------------------- |
| CREATE | 在数据库中创建一个新对象，例如表或视图。 |
| ALTER  | 修改对象的结构。例如，更改表以添加新列。 |
| DROP   | 从数据库中删除一个对象。                 |
| RENAME | 重命名现有对象。                         |

**_DROP 语句非常强大。删除表时，该表中的所有行都将丢失。除非您有备份，否则您将无法检索此数据。_**

下面的示例创建了一个新的数据库表。括号之间内指定了每列的详细信息，包括名称、数据类型、值是否非空（NOT NULL）以及列中的数据是否用于唯一（PRIMARY KEY ）。每个表都应该有一个主键，尽管 SQL 不强制执行此规则。

标记为 NOT NULL 的列称为强制列。如果省略 NOT NULL 子句，则可以创建列中不包含值的行。行中的空列被称为含有 NULL 值。

```sql
CREATE TABLE Product
(
    ID INT PRIMARY KEY,
    Name VARCHAR(20) NOT NULL,
    Price DECIMAL NULL
);
```

表中列可用的数据类型因不同的数据库管理系统而异。但是，大多数数据库管理系统都支持诸如 INT 数值类型（整数）、DECIMAL（十进制数）和字符串（如 VARCHAR）类型。

**DCL 语句**

数据库管理员通常使用 DCL 语句来授予、拒绝或撤销特定用户或组的权限来管理对数据库中对象的访问。

三个主要的 DCL 语句是：

| 语句   | 描述                     |
| ------ | ------------------------ |
| GRANT  | 授予执行特定操作的权限。 |
| DENY   | 拒绝执行特定操作的权限。 |
| REVOKE | 删除之前授予的权限。     |

例如，以下 GRANT 语句允许名为 user1 的用户读取、插入和修改 Product 表中的数据。

```sql
GRANT SELECT, INSERT, UPDATE
ON Product
TO user1;
```

**DML 语句**

您使用 DML 语句来操作表中的行。这些语句使您能够检索（查询）数据、插入新行或修改现有行。如果不再需要某些行，也可以删除它们。

四个主要的 DML 语句是：

| 语句   | 描述                 |
| ------ | -------------------- |
| SELECT | 从表中读取行。       |
| INSERT | 向表中插入新行。     |
| UPDATE | 修改现有行中的数据。 |
| DELETE | 删除现有行。         |

INSERT 语句的基本形式是一次插入一行。默认情况下，SELECT、UPDATE 和 DELETE 语句应用于表中的每一行。通常在这些语句中应用 WHERE 子句来指定条件，只有符合这些条件的行才会被选择、更新或删除。

**_SQL 没有二次确认提示。因此在使用不带 WHERE 子句的 DELETE 或 UPDATE 时要小心，因为您可能会丢失或修改大量数据。_**

### 1.4 描述数据库对象

## 2 Azure 中的关系型数据库服务

> 参考资料
>
> [1] [Exam DP-900: Microsoft Azure Data Fundamentals - learn.microsoft.com](https://learn.microsoft.com/en-us/certifications/exams/dp-900)
